<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>CoinRoster | Daily Fantasy Sports | Bitcoin</title>
    <meta name="description" content="CoinRoster offers Daily Fantasy Sports for Bitcoin! Join a contest, create a roster, and win!" />
    <meta name="keywords" content="coinroster, bitcoin, daily fantasy sports, dfs, fantasy sports" />
    <meta name="Robots" content="index,follow,NOODP" />  
    <meta name="googlebot" content="NOODP" />        
    <meta name="rating" content="General" />
    <!--#include virtual="/ssi/head.html" -->
    <link rel="stylesheet" type="text/css" href="/css/lobby.css">
    <script type="text/javascript" src="/js/lobby.js"></script>
</head>
<body>
<!--#include virtual="/ssi/nav.html" -->
<!--#include virtual="/ssi/simple_modal.html" -->
<div id="centering_container">
    <div id="body_container">
        <!-- POPULATED BY JAVASCRIPT -->
    </div>
</div>
<script type="text/javascript">
    
    var body_container = id("body_container");
    
    window.onhashchange = function()
        {
        trigger_hash_action();
        };

    function init()
        {
        if (location.hash.indexOf("#") !== -1) return trigger_hash_action();
        
        id("ssi_header_lobby").className = "ssi_header_active_tab";
        
        api({
            method: "CategoryReport",
            args: {
                request_source: "lobby"
            }
        }, function(call)
            {
            var category_report = call.category_report;

            body_container.innerHTML = "<br/>";

            for (var i=0; i<category_report.length; i++)
                {
                var hr = document.createElement("hr");
                hr.size = 1;
                hr.noShade = true;
                body_container.appendChild(hr);
                    
                var category = category_report[i],

                category_code = category.code,
                description = category.description,
                position = category.position,
                sub_categories = category.sub_categories,
                number_of_sub_categories = sub_categories.length;

                var heading = document.createElement("h3");
                heading.className = "section_header";
                heading.innerHTML = description;
                body_container.appendChild(heading);
                
                if (number_of_sub_categories > 0)
                    {
                    for (var j=0; j<number_of_sub_categories; j++)
                        {
                        var sub_category = sub_categories[j],

                        sub_category_code = sub_category.code,
                        
                        open_contests = sub_category.open_contests,
                        in_play_contests = sub_category.in_play_contests,
                        
                        modulus = j%4,
                        
                        margin_class = "",
                        open_contests_color = "";
                
                        if (modulus !== 3) margin_class = " sub_category_add_margin";
                
                        if (open_contests > 0) open_contests_color = " orange";
                        
                        if (open_contests === 1) open_contests = "1 open contest";
                        else open_contests += " open contests";
                        
                        if (in_play_contests === 0) in_play_contests = "";
                        else in_play_contests = in_play_contests + " in play";
                
                        var sub_category_item = document.createElement("a");
                        sub_category_item.className = "sub_category_item" + margin_class;
                        sub_category_item.href = "/lobby.html#category=" + category_code + "&sub_category=" + sub_category_code;
                        
                        var sub_category_tile = document.createElement("div");
                        sub_category_tile.className = "sub_category_tile";
                        sub_category_tile.setAttribute("style", "background-image:url('/img/lobby_tiles/" + sub_category.image_name + "')");
                        sub_category_item.appendChild(sub_category_tile);
                        
                        var sub_category_details = document.createElement("div");
                        sub_category_details.className = "sub_category_details";
                        sub_category_item.appendChild(sub_category_details);
                        
                        var sub_category_description = document.createElement("div");
                        sub_category_description.className = "sub_category_description";
                        sub_category_description.innerHTML = sub_category.description;
                        sub_category_details.appendChild(sub_category_description);
                        
                        var sub_category_open_contests = document.createElement("div");
                        sub_category_open_contests.className = "sub_category_detail" + open_contests_color;
                        sub_category_open_contests.innerHTML = open_contests;
                        sub_category_details.appendChild(sub_category_open_contests);
                        
                        var sub_category_in_play = document.createElement("div");
                        sub_category_in_play.className = "sub_category_detail small_text";
                        sub_category_in_play.innerHTML =  in_play_contests;
                        sub_category_details.appendChild(sub_category_in_play);
                        
                        /*sub_category_item.onclick = (function(category_code, sub_category_code)
                            {
                            return function()
                                {
                                location.hash = "category=" + category_code + "&sub_category=" + sub_category_code;
                                };
                            })(category_code, sub_category_code);*/
                        
                        body_container.appendChild(sub_category_item);
                        }
                    }
                else body_container.appendChild(document.createTextNode("No sub-categories"));
                }
            });
        }
        
    function trigger_hash_action()
        {
        if (location.hash.indexOf("#") === -1) init();
        else hash_action(location.hash.slice(1));
        }
        
    function hash_action(hash)
        {
        var 

        hash_args = hash.split("&"),
        category = hash_args[0].split("=")[1],
        sub_category = hash_args[1].split("=")[1];

        id("ssi_header_lobby").className = "ssi_header_a";
        
        body_container.innerHTML = "<br/>";
        
        var hr = document.createElement("hr");
        hr.size = 1;
        hr.noShade = true;
        body_container.appendChild(hr);
        
        api({ 
            method: "ContestReport", 
            args: {
                category: category,
                sub_category: sub_category
            } 
        }, function(call)
            {
            var
            
            category_description = call.category_description,
            sub_category_description = call.sub_category_description;
                   
            var heading = document.createElement("h3");
            heading.className = "section_header";
            heading.innerHTML = category_description + "&nbsp;&nbsp;&bull;&nbsp;&nbsp;" + sub_category_description;
            body_container.appendChild(heading);

            var table = document.createElement("table");
            table.className = "contest_table";
            body_container.appendChild(table);
        
            var 
            
            contest_report = call.contest_report,
            contest_report_array = [],
            number_of_contests = contest_report.length;
    
            if (number_of_contests === 0)
                {
                var row = new_row(table, -1, [
                    "No open contests. Please check back soon."
                ]);
                row[1].style.textAlign = "left";
                }
            else
                {
                var header = new_row(table, -1, [
                    "Contest",
                    "Game type",
                    "Min entry",
                    "Entries",
                    "Prize pool",
                    "Live at",
                    ""
                ]);
                
                header[0].style.background = "none";
                header[0].style.border = "none";
                
                for (var i=1; i<header.length; i++)
                    {
                    header[i].style.fontSize = "14px";
                    header[i].style.paddingBottom = "10px";
                    }
                    
                header[1].style.textAlign = "left";
                header[2].style.textAlign = "left";
                
                var last_status = 0;

                for (var i=0; i<number_of_contests; i++)
                    {
                    var contest_item = contest_report[i],

                    contest_id = contest_item.id,
                    contest_type = contest_item.contest_type,

                    title = contest_item.title,
                    settlement_type = contest_item.settlement_type,
                    pay_table = contest_item.pay_table,
                    cost_per_entry = contest_item.cost_per_entry,
                    
                    total_prize_pool = contest_item.total_prize_pool,
                    number_of_entries = total_prize_pool / cost_per_entry,
                    
                    registration_deadline = contest_item.registration_deadline,
                    registration_deadline_date = dateconv_ms_to_string(registration_deadline),
                    registration_deadline_time = dateconv_ms_to_time(registration_deadline),
                    registration_deadline_string = "<div style=\"white-space:nowrap\">" + registration_deadline_date + "</div>" + registration_deadline_time,
                    
                    status = contest_item.status,
                    status_string,
                    button_string,
                    button_class;
            
                    switch (status)
                        {
                        case 1:
                            button_string = "Enter";
                            status_string = "Reg open";
                            button_class = "orange orange_border";
                            break;
                        case 2:
                            button_string = "View";
                            status_string = "In play";
                            registration_deadline_string = "In play";
                            button_class = "";
                            //continue;
                            break;
                        }
                        
                    if (status !== last_status)
                        {
                        // will fire when status changes as rows are looped through
                        // to make this only fire on the change to 'in play', initialize last_status = 1
                        }
                        
                    var game_type = settlement_type_string(settlement_type) + "<br/><div id=\"payout_info_" + contest_id + "\" class=\"payout_info_link teal\">Payout info</div>";
                        
                    var row = new_row(table, -1, [
                        title,
                        game_type,
                        cost_per_entry + " BTC",
                        number_of_entries,
                        total_prize_pool + " BTC",
                        registration_deadline_string,
                        "<button class=\"text_button " + button_class + "\" style=\"width:auto\" onclick=\"redirect_to_contest(" + contest_id + ")\">" + button_string + "</button>"
                    ]);

                    row[1].onclick = (function(contest_id)
                        {
                        return function()
                            {
                            redirect_to_contest(contest_id);
                            }
                        })(contest_id);
                    row[1].style.textAlign = "left";
                    row[2].style.textAlign = "left";

                    bind_payout_window(id("payout_info_" + contest_id), settlement_type, pay_table);
                    }
                }
            });
        }

    function redirect_to_contest(contest_id)
        {
        location = "/contest.html?id=" + contest_id;
        }
        
</script>
<script type="text/javascript" src="/js/nav.js"></script>
<!--#include virtual="/ssi/google_analytics.html" -->
</body>
</html>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>CoinRoster | Auto-Play</title>
    <!--#include virtual="/ssi/head.html" -->
    <link rel="stylesheet" type="text/css" href="/css/account.css">
    <link rel="stylesheet" type="text/css" href="/css/lobby.css">
    <link rel="stylesheet" type="text/css" href="/css/autoplay.css">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script type="text/javascript" src="/js/lobby.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    
</head>
<body>
<!--#include virtual="/ssi/simple_modal.html" -->
<div id="page_body">
    <div id="centering_container">
        <!--#include virtual="/ssi-java/nav" -->
        <div id="category_header" class="body_container header">
            <h3 class="section_header">
                <span id="path_text">
                    <a href="/account" class='inline_link steel'>MY ACCOUNT</a><!--
                    --><span class='path_slash red_orange'>/</span><!--
                    --><span class='orange'>AUTO-PLAY</span>
                </span>
            </h3>
        </div>
        <div class="body_container extra_body_container_padding">
            <br/>
            <div class="description_text ">
                View/Modify your AUTO-PLAY entries
            </div>
            <br/>
            <br/>
            <div class="table_body_container">
                <table id="user_autoplay_entries" class="contest_table"></table>
            </div>
            <br/>
            <br/>
            <hr>
            <div class="description_text constrain_width">
                Enter new AUTO-PLAY entries
            </div>
            
            <br/>
            <br/>
            <div class="table_body_container">
                <table id="possible_contests" class="contest_table"></table>
            </div>
            <br/>
            <br/>
            
            <div id="modify" class="autoplay_modify hidden">
                        
                <div class="misc_reg_deadline input_padding">
                    <span class="input_label">Start Date</span>
                    <div class="contest_registration_options">
                        <input type="text" id="start_date" class="input_style chosen-select" style="width:95px" placeholder="mm/dd/yyyy" readonly="true">
                    </div>
                </div>

                <div class="misc_set_deadline input_padding">
                    <span class="input_label">End Date</span>
                    <div class="contest_registration_options">
                        <input type="text" id="end_date" class="input_style chosen-select" style="width:95px" placeholder="mm/dd/yyyy" readonly="true">
                    </div>
                </div>

                <div class="prop_golf_number_of_shots_round_tournament input_padding">
                        <span class="input_label">Roster Draft Algorithm</span>
                        <div>
                            <input type="radio" value="BARBELL" name="algorithm" id="BARBELL"/>
                            <label class="algorithm_label" for="BARBELL">BARBELL</label>
                        </div>
                        <div>
                            <input type="radio" value="SAFE" name="algorithm" id="SAFE"/>
                            <label class="algorithm_label" for="SAFE">SAFE</label>
                        </div>
                        <div>
                            <input type="radio" value="RANDOM" name="algorithm" id="RANDOM"/>
                            <label class="algorithm_label" for="RANDOM">RANDOM</label>
                        </div>
                    </div>

                <div class="misc_min_wager input_padding">
                    <span class="input_label">Number of Rosters</span>
                    <input type="number" style="font-family:FontAwesome, 'gotham_medium'; width: 100px;" placeholder="1" class="input_style" id="number_rosters"/>
                </div>
                <div class="misc_settlement_type input_padding">
                    <span class="input_label">Active?</span>
                    <div>
                        <input type="radio" value="true" name="active_radio" id="true"/>
                        <label class="active_label" for="true">Yes</label>
                    </div>
                    <div>
                        <input type="radio" value="false" name="active_radio" id="false"/>
                        <label class="active_label" for="false">No</label>
                    </div>
                </div>
            </div>

        </div>
        <br/>
    </div>
</div>
<!--#include virtual="/ssi/footer.html" -->
<script type="text/javascript">

    function init(){
        var 
        user_table = id("user_autoplay_entries");
                
        api({ 
            method: "GetUserAutoplays", 
            args: {} 
        }, 
        function(call){
            var entries = call.entries;
            window["user_autoplay_entries"] = entries;
            if(entries.length === 0){
                user_table.innerHTML = `<tr>No AUTO-PLAY entries</tr>`;
            }
            else{
                populate_user_entries(call.entries, user_table);
            }
        });
    }
    
    function populate_user_entries(data, table){
        var header = new_row(table, -1, [
            "Contest",
            "Settlement Type",
            "Cost per Entry",
            "Start Date",
            "End Date",
            "Algorithm",
            "Number of Rosters",
            "Active"
        ]);

    for (var i=0; i<data.length; i++){

        var contest_item = data[i],

        entry_id = contest_item.id,
        sport = contest_item.sport,
        title = contest_item.contest_title,
        desc = contest_item.contest_desc,
        settlement_type = contest_item.settlement_type,
        pay_table = contest_item.pay_table,
        cost_per_entry = contest_item.cost_per_entry,
        start_date = contest_item.start_date,
        end_date = contest_item.end_date,
        algorithm = contest_item.algorithm,
        num_rosters = contest_item.num_rosters,
        active = contest_item.active;

        var 

        title_link = sport + " | " + title,
        game_type = "<span id=\"payout_" + entry_id + "\" class=\"payout_info_link teal\">" + settlement_type_string(settlement_type) + "</span>",

        row = new_row(table, -1, [
            "<ul><li>" + title_link + "</li><li class='draft_button' onclick='modify_entry(this, " + entry_id + ")'>" + "Modify" + "</li></ul>",
            "<div class='field_label'>Game Type:</div>" + game_type,
            "<div class='field_label'>Entry fee:</div>" + toBTC(cost_per_entry) + " BTC" + getFiatDisplay(cost_per_entry, "allow_inline"),
            "<div class='field_label'>Start Date:</div>" + start_date,
            "<div class='field_label'>End Date:</div>" + end_date,
            "<div class='field_label'>Algorithm:</div>" + algorithm,
            "<div class='field_label'>Number of Rosters:</div>" + num_rosters,
            "<div class='field_label'>Active:</div>" + (active ? `<input type='checkbox' style='margin: 0;' checked disabled />` : `<input type='checkbox' style='margin: 0;' disabled />`),
        ]);
        bind_payout_window(id("payout_" + entry_id), settlement_type, pay_table);
        }
    }
    
    function modify_entry(element, entry_id){
        var mod_div;
        var parent = element.closest("tr");
        var entries = window.user_autoplay_entries;
        for(i = 0; i < entries.length; i++){
            if(entries[i].id === entry_id){
                var data = entries[i];
                document.getElementById("modify").style.display = "block";
                
                var s_date = data.start_date;
                s_date = s_date.split("-");
                var s_date_to_show = s_date[1] + "/" + s_date[2] + "/" + s_date[0]
                
                var e_date = data.end_date;
                e_date = e_date.split("-");
                var e_date_to_show = e_date[1] + "/" + e_date[2] + "/" + e_date[0]
                id("start_date").value = data.start_date;
                id("start_date").placeholder = data.s_date_to_show;
                id("end_date").value = data.end_date;
                id("end_date").placeholder = data.e_date_to_show;
                var algo = data.algorithm;
                id(algo).checked = true;
                id("number_rosters").value = data.num_rosters;
                id("number_rosters").placeholder = data.num_rosters;
                if(data.active)
                    id("true").checked = true;
                else
                    id("false").checked = false;
            }
        }
    }
           
</script>
<script>
        var dateToday = new Date();
        var dates = $("#start_date, #end_date").datepicker({
            defaultDate: "+1w",
            changeMonth: true,
            numberOfMonths: 1,
            minDate: dateToday,
            onSelect: function(selectedDate) {
                var option = this.id == "start_date" ? "minDate" : "maxDate",
                    instance = $(this).data("datepicker"),
                    date = $.datepicker.parseDate(instance.settings.dateFormat || $.datepicker._defaults.dateFormat, selectedDate, instance.settings);
                dates.not(this).datepicker("option", option, date);
            }
        });
</script>
<script type="text/javascript" src="/js/nav.js"></script>
<!--#include virtual="/ssi/google_analytics.html" -->
</body>
</html>

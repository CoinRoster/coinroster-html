<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>CoinRoster | Create A Contest</title>
    <!--#include virtual="/ssi/head.html" -->
    <link rel="stylesheet" type="text/css" href="/css/account.css">
    <script type="text/javascript" src="/js/account.js"></script>
</head>
<body>
<!--#include virtual="/ssi/simple_modal.html" -->
<div id="page_body">
    <div id="centering_container">
        <!--#include virtual="/ssi-java/nav" -->
        <div id="category_header" class="body_container header">
            <h3 class="section_header">
                <span id="path_text">
                    <a href="/account" class='inline_link steel'>MY ACCOUNT</a><!--
                    --><span class='path_slash red_orange'>/</span><!--
                    --><span class='orange'>YOUR CONTESTS</span>
                </span>
            </h3>
            <div id="user_contest_table" class="report_table"></div>
            <div id="settle_contest" class="content_body" style="top:68px">
                <div style="width:800px;background:orange;padding:20px;font-size:18px;">
                    You are in the Contest Settlement tab! If you only want to update scores, please <button type="button" class="input_style" onclick="cancel_settle_contest();">Go back</button>
                </div>
                <br/>
                <h3 style="font-weight:normal">
                    Contest <span id="contest_id"></span> | <span id="contest_type"></span>
                </h3>
                <h2>
                    <span id="contest_title"></span>
                </h2>
                <div id="settle_pari_mutuel">
                    Select winning outcome:
                    <br/><br/>
                    <div id="pari_mutuel_outcome_table" class="report_table"></div>
                    <br/>
                    <button type="button" class="input_style" onclick="settle_pari_mutuel_contest();">Settle Contest</button>
                </div>
            </div>
        </div>
        <br/>
    </div>   
</div>
<!--#include virtual="/ssi/footer.html" -->
<script type="text/javascript" src="/js/lib.js"></script>
<script>

    function init() {
        hide("settle_contest");
        populate_user_contest();
    }

    function populate_user_contest() {
        var call = api({ method: "GetUserContests", args: {} });
        
        if (call.status === "1") {
            
            var
            
            pending_contest_array = call.pending_contests,
            number_of_contests = pending_contest_array.length,
            table = new_table("user_contest_table"),
            row_count = 0;
            table.border = "1",
            contest_obj = [];
            if (number_of_contests > 0) {
                for (var i = 0; i < number_of_contests; i++) {
                    var contest_item = pending_contest_array[i],

                    contest_id = contest_item.contest_id,
                    created = contest_item.created,
                    created_date = dateconv_ms_to_string(created),
                    created_time = dateconv_ms_to_time(created),
                    created_by = contest_item.created_by,
                    category = contest_item.category,
                    title = contest_item.title,
                    description = contest_item.description,
                    settlement_type = contest_item.settlement_type,
                    option_table = contest_item.option_table,
                    rake = contest_item.rake,
                    cost_per_entry = contest_item.cost_per_entry;
                    
                    contest_obj.push({
                        contest_id: contest_id,
                        created_date: created_date,
                        created_time: created_time,
                        created_by: created_by,
                        category: category,
                        title: title,
                        description: description,
                        settlement_type: settlement_type,
                        option_table: option_table,
                        rake: rake,
                        cost_per_entry: cost_per_entry,
                    });

                    var row = new_row(table, row_count++, [
                        contest_id,
                        created_date,
                        created_time,
                        created_by,
                        category,
                        title,
                        description,
                        settlement_type,
                        option_table,
                        rake,
                        cost_per_entry ,
                        "<button onclick=\"settle_contest(" + contest_obj[i] + ")\">Settle Contest</button>"
                    ]);

                    row[1].style.textAlign = "right";
                    row[6].style.textAlign = "right";
                    
                    // highlight if older than 30 days:
                    
                    if (new Date().getTime()-30*1440*60*1000 > created) row[2].style.background = "rgb(255,231,166)";
                }
                
                var header = new_row(table, 0, [
                    "#",
                    "Date",
                    "Time",
                    "Created By",
                    "Category",
                    "Title",
                    "Description",
                    "Settlement Type",
                    "Option Table",
                    "Rake",
                    "Cost Per Entry",
                    "Settle"
                ]);
                // style headers:

                for (var i=1; i<header.length; i++) header[i].className = "header_cell";
        
                header[1].style.textAlign = "center";
                header[6].style.textAlign = "right";
            }
            else id("user_contest_table").innerHTML = "None";
        }
        else id("user_contest_table").innerHTML = "Error getting transactions";       
    }

     
     function settle_contest(contest_obj)
        {
        window.contest_id_to_settle = contest_obj.contest_id;
        
        var 
        
        contest_type = contest_obj.contest_type,
        contest_title = contest_obj.title,
        // scores_updated = contest_item.scores_updated,
        option_table = JSON.parse(contest_obj.option_table);

        hide("in_play_contest_report");
        show("settle_contest");
        id("contest_type").innerHTML = contest_type;
        id("contest_id").innerHTML = contest_id;
        id("contest_title").innerHTML = contest_title;

        show("settle_pari_mutuel");
        
        var table = new_table("pari_mutuel_outcome_table");
        
        for (var i=0; i<option_table.length; i++)
            {
            var option_item = option_table[i],
                    
            option_id = option_item.id,
            description = option_item.description;
            
            new_row(table, -1, [
                "<input type=\"radio\" name=\"pari_mutuel_outcome_radio\" value=\"" + option_id + "\" />",
                option_id,
                description
            ]);
            }
        }

</script>
<script type="text/javascript" src="/js/btc_inputs.js"></script>
<script type="text/javascript" src="/js/nav.js"></script>
<!--#include virtual="/ssi/google_analytics.html" -->
</body>
</html>

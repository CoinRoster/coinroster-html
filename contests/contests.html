<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>CoinRoster | My Contests</title>
    <!--#include virtual="/ssi/head.html" -->
    <link rel="stylesheet" type="text/css" href="/css/lobby.css">
    <link type="text/css" rel="stylesheet" href="/css/contest_status_selector.css" />
    <script type="text/javascript" src="/js/account.js"></script>
    <script type="text/javascript" src="/js/lobby.js"></script>
</head>
<body>
<!--#include virtual="/ssi-java/nav" -->
<!--#include virtual="/ssi/simple_modal.html" -->
<div id="centering_container">
    <div class="body_container">
        <br/>
        <h3 class="section_header">My Contests</h3>
    </div>
<!--#include virtual="/ssi/contest_status_selector.html" -->
    <div class="body_container">
        <div id="no_data_message" class="hidden"></div>
        <div id="exposure_container" class="hidden">
            On the line:<span id="exposure_value" class="orange"></span>
        </div>
    </div>
    <div class="table_body_container">
        <table id="contest_report_table" class="contest_table"></table>
    </div>
</div>
<script>
 
    function init()
        {
        update_contest_status_selector();
        
        api({
            method: "ContestReport_MyContests",
            args: {
                contest_status: window.session.contest_status
            }
        }, function(call)
            {
            if (call.status === "1") 
                {
                var 
                
                user_contest_report = call.user_contest_report,
                number_of_contests = user_contest_report.length,
                
                table = id("contest_report_table");
        
                table.innerHTML = "";
                
                if (number_of_contests === 0) 
                    {
                    show("no_data_message");
                    id("no_data_message").innerHTML = "You have no open or in-play contests.";
                    return;
                    }
                     
                var header = new_row(table, -1, [
                    "Contest",
                    "Status",
                    "On the line",
                    "Category"
                ]);
                
                var in_play_value = 0;

                for (var i=0; i<number_of_contests; i++)
                    {
                    var contest_item = user_contest_report[i],

                    contest_id = contest_item.id,
                    contest_type = contest_item.contest_type,
                    category_description = contest_item.category_description,
                    sub_category_description = contest_item.sub_category_description,
                    title = contest_item.title,
                    settlement_type = contest_item.settlement_type,
                    cost_per_entry = contest_item.cost_per_entry,
                    user_entries_count = contest_item.user_entries_count,
                    user_entries_value = contest_item.user_entries_value,
                    contest_status = contest_item.status,
                    status_string = contest_status_string(contest_status),
                    button_class = "";

                    if (contest_status < 3) 
                        {
                        in_play_value = add(in_play_value, user_entries_value);
                        button_class = " orange orange_border";
                        }
                        
                    var button_string = "";

                    if (contest_type === "PARI-MUTUEL") button_string += "My wagers";
                    else if (contest_type === "ROSTER") button_string += "My rosters";

                    var 
                    
                    title_link = "<a href='/contest.html?id=" + contest_id + "' class='first_cell_link'>" + title + "</a>",
                    enter_button = "<a class=\"contest_table_link" + button_class + "\" style=\"white-space:nowrap;float:right;width:auto\" onclick=\"show_user_entries(" + contest_id + ")\"'>" + button_string + "</button>";

                    var row = new_row(table, -1, [
                        "<ul><li>" + title_link + "</li><li>" + enter_button + "</li></ul>",
                        "<div class='field_label'>Deadline:</div>" + status_string,
                        "<div class='field_label'>On the line:</div>" + user_entries_value + " BTC",
                        "<div class='field_label'>Category:</div>" + category_description + " &bull; " + sub_category_description
                    ]);

                    for (var cell=2; cell<row.length; cell++) row[cell].style.whiteSpace = "nowrap";
                    }
                    
                if (in_play_value > 0)
                    {
                    show("exposure_container");
                    id("exposure_value").innerHTML = toBTC(in_play_value) + " BTC";
                    }
                }
            });
        }
   
    function show_user_entries(contest_id)
        {
        window.location = "/contests/entries.html?contest_id=" + contest_id;
        }
        
</script>
<script type="text/javascript">
    window.nav_text = "My Contests";
</script>
<script type="text/javascript" src="/js/contest_status_selector.js"></script>
<script type="text/javascript" src="/js/nav.js"></script>
<!--#include virtual="/ssi/google_analytics.html" -->
</body>
</html>

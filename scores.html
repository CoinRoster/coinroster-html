<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>CoinRoster | Lobby</title>
    <!--#include virtual="/ssi/head.html" -->
    <link rel="stylesheet" type="text/css" href="/css/lobby.css">
    <script type="text/javascript" src="/js/lobby.js"></script>
    <script type="text/javascript" src="/js/account.js"></script>
</head>
<body>
<!--#include virtual="/ssi-java/nav" -->
<!--#include virtual="/ssi/simple_modal.html" -->
<div id="centering_container">
    <div id="body_container">
        <br/>
        <h3 id="contest_title" class="section_header">
            <!-- POPULATED BY JAVASCRIPT -->
        </h3>
        <div id="no_data_message" class="hidden"></div>
    </div>
    <div class="table_body_container">
        <table id="score_table" class="contest_table"></table>
    </div>
</div>
<script type="text/javascript" src="/js/btc_inputs.js"></script>
<script>

    function init()
        {
        var contest_id = get_url_param("contest_id") | 0;
        
        window.contest_id = contest_id;
        
        if (contest_id !== 0)
            {
            api({
                method: "GetContestDetails",
                args: {
                    contest_id: contest_id
                }
            }, function(call)
                {
                if (call.status === "1")
                    {                    
                    var
                    
                    category = call.category,
                    sub_category = call.sub_category,
                    contest_type = call.contest_type,
                    title = call.title,
                    description = call.description,
                    current_users = call.current_users,
                    max_users = call.max_users,
                    entries_per_user = call.entries_per_user,
                    registration_deadline_ms = call.registration_deadline,
                    registration_deadline_date = dateconv_ms_to_string(registration_deadline_ms),
                    registration_deadline_time = dateconv_ms_to_time(registration_deadline_ms),
                    settlement_type = call.settlement_type,
                    cost_per_entry = call.cost_per_entry,
                    rake = call.rake,
                    option_table = JSON.parse(call.option_table),
                    pay_table = call.pay_table,
                    contest_status = call.contest_status;
                        
                    id("contest_title").innerHTML = title;
            
                    if (contest_type !== "ROSTER") return special_no_data_message("Contest #" + contest_id + " is not a roster contest");
                    if (contest_status < 3) return special_no_data_message("Contest #" + contest_id + " has not been settled");
                    if (contest_status > 3) return special_no_data_message("Contest #" + contest_id + " was cancelled");
                    
                    var 
                    
                    table = id("score_table"),
                    raw_score_header = "";
                    
                    option_table.sort(function(a, b)
                        {
                        return b.score - a.score;
                        });
                    
                    for (var i=0; i<option_table.length; i++)
                        {
                        var player_item = option_table[i],
                                
                        name = player_item.name,
                        price = player_item.price,
                        score = player_item.score,
                        score_raw = player_item.score_raw;
                
                        var row_data = [
                            name,
                            "<div class='field_label'>Price:</div>" + "$" + commas(price),
                            "<div class='field_label'>Score:</div>" + score
                        ];
                        
                        if (score !== score_raw) 
                            {
                            if (sub_category.toUpperCase().indexOf("GOLF") !== -1) raw_score_header = "Score to par";
                            else raw_score_header = "Raw score";
                            
                            row_data.splice(2, 0, "<div class='field_label'>" + raw_score_header + "</div>" + score_raw);
                            }
                
                        var row = new_row(table, -1, row_data);
                        
                        row[1].style.textAlign = "left";
                        }
                     
                    
                    var header_data = [
                        "Player",
                        "Price",
                        "Score"
                    ];
                    
                    if (raw_score_header !== "") header_data.splice(2, 0, raw_score_header);

                    var header = new_row(table, 0, header_data);
                    
                    header[1].style.textAlign = "left";
                    }
                else special_no_data_message(call.error);
                });
            }
        else special_no_data_message("Invalid contest ID");
        }
        
    function special_no_data_message(message)
        {
        show("no_data_message");
        id("contest_title").innerHTML = "Contest Page";
        id("contest_title").id = ""; // changes color to white
        id("no_data_message").innerHTML = message;
        }
                     
</script>
<script type="text/javascript">
    window.nav_text = "Contest #" + get_url_param("contest_id");
</script>
<script type="text/javascript" src="/js/nav.js"></script>
<!--#include virtual="/ssi/google_analytics.html" -->
</body>
</html>

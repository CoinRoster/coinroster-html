<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>CoinRoster | Create an account</title>
    <!--#include virtual="/ssi/head.html" -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="description" content="CoinRoster offers Daily Fantasy Sports for Bitcoin! Join a contest, create a roster, and win!" />
    <meta name="keywords" content="Bitcoin, Daily Fantasy Sports, BTC, Fantasy Sports, Online" />
    <meta name="Robots" content="index,follow,NOODP" />  
    <meta name="googlebot" content="NOODP" />        
    <meta name="rating" content="General" />
</head>
<body>
<!--#include virtual="/ssi/auto_login.html" -->
<!--#include virtual="/ssi/carousel.html" -->
<table id="landing_center">
    <tr>
        <td>
            <div>
                <div>
                    <h1>
                        CoinRoster
                    </h1>
                    <div id="message" class="vertical_spacing"></div>
                    <form autocomplete="off" onsubmit="return create_account();">
                        <input type="password" style="position:absolute;top:-1000px;"/>
                        Username: 4 to 40 chars
                        <div class="input_padding">
                            <input placeholder="Username" label="false" id="username" type="text" class="input_style" maxlength="40" tabindex="1" autocorrect="off" autocapitalize="off" spellcheck="false">
                        </div>
                        Password: 8 or more chars
                        <div class="input_padding">
                            <input placeholder="Password" label="false" id="password" type="password" class="input_style" tabindex="2">
                        </div>
                        <div class="input_padding">
                            <input placeholder="Confirm password" label="false" id="confirm_password" type="password" class="input_style" tabindex="3">
                        </div>
                        <div class="input_padding">
                            <button class="text_button" style="color:orange;" type="submit" tabindex="4">Create account</button>
                        </div>
                    </form>
                </div>
            </div>
        </td>
    </tr>
</table>
<script type="text/javascript">
    
    var 
    
    search_variable = location.search.split("?")[1],
    referral_key;
    
    if (typeof search_variable === "undefined") referral_key = "";
    else referral_key = search_variable;
    
    var inputs = document.getElementsByTagName('input');
    for (var i = 0; i < inputs.length; i += 1) inputs[i].value = "";

    function set_message(message, color)
        {
        id("message").innerHTML = "<ul><li>" + message + "</ul></li>";
        id("message").style.color = color;
        }
    
    function set_focus(_id)
        {
        setTimeout(function()
            {
            id(_id).focus();
            },100);
        }

    id("username").onblur = function(){check_username();};
    id("password").onblur = function(){check_password();};

    function check_username()
        {
        var username = id("username").value.replace(/\s/gi, "");
        if (username === "") return;
        if (username.length < 4)
            {
            set_message("Username must be<br/>4 characters or longer", "red");
            id("username").value = "";
            set_focus("username");
            return;
            }
            
        setTimeout(function()
            {
            var call = api({
                method: "check_username",
                args: {
                    username: username
                }
            });

            if (call.status === "1") set_message("Username is available", "white");
            else
                {
                set_message(call.error, "red");
                id("username").value = "";
                set_focus("username");
                }   
            },10);
        }

    function check_password()
        {
        var password = id("password").value.replace(/\s/gi, "");
        if (password !== "" && password.length < 8)
            {
            set_message("Password must be<br/>8 characters or longer", "red");
            id("password").value = "";
            id("confirm_password").value = "";
            set_focus("password");
            }
        }
        
    function create_account()
        {
        var username = id("username").value.replace(/\s/gi, ""),
        password = id("password").value.replace(/\s/gi, ""),
        confirm_password = id("confirm_password").value.replace(/\s/gi, "");

        if (referral_key.length !== 40)
            {
            set_message("Invalid referral code", "red");
            return false;
            }
        if (username === "")
            {
            set_message("Enter a username", "red");
            set_focus("username");
            return false;
            }
        if (password === "")
            {
            set_message("Enter a password", "red");
            set_focus("password");
            return false;
            }
        if (confirm_password === "")
            {
            set_message("Confirm password", "red");
            set_focus("confirm_password");
            return false;
            }
        if (password !== confirm_password)
            {
            set_message("Passwords do not match", "red");
            id("password").value = "";
            id("confirm_password").value = "";
            set_focus("password");
            return false;
            }

        setTimeout(function()
            {
            var call = api({
                method: "create_user",
                args: {
                    username: username,
                    password: password,
                    referral_key: referral_key
                }
            });

            if (call !== null)
                {
                if (call.user_was_created === "1") document.location = "../account/?first_login";
                else
                    {
                    if (call.invalid_credentials === "1") set_message("Invalid credentials", "red");
                    else if (call.username_exists === "1") set_message(username + " is taken", "red");
                    else if (call.invalid_referrer === "1") set_message("Invalid referral code", "red");
                    else set_message("Problem with account creation", "red");
                    id("username").value = "";
                    id("password").value = "";
                    id("confirm_password").value = "";
                    set_focus("username");
                    }
                }
            },100);
        return false;
        }

</script>
</body>
</html>
